<head>
  <script src="//www.parsecdn.com/js/parse-1.6.7.min.js"></script>
</head>

<body onload="GetParse()">

  <img id="image" style="margin-left: 350; display:none;" src="http://mscoco.org/images/44474" />
  <div id="tagPara" style="display: block; text-align:center;">
    <h4 id="tagview"> </h4>
    Is this a good tag?
    <input type="radio" name="tags" id="yesTag">Yes
    <input type="radio" name="tags" id="noTag">No
    <button onclick="nextTagClick()">Next Tag</button>
  </div>

  <br>
  <div id="questionsPara" style="display:none; text-align:center;">How would you describe the main person's emotion:
    <input type="text" name="answer" id="answer">
    <button onclick="addTag()">Add</button>
    <br>
    <br> How many people are there: </h>
    <input type="radio" name="people" id="people_zero">0
    <input type="radio" name="people" id="people_one">1
    <input type="radio" name="people" id="people_two">2
    <input type="radio" name="people" id="people_three">3
    <input type="radio" name="people" id="people_four">4 or more

    <br>
    <br> Is this a good image for this task:
    <input type="radio" name="good" id="good_yes">Yes
    <input type="radio" name="good" id="good_no">No
    <br>
    <br>
    <button onclick="nextPicClick()">Next Picture</button>
  </div>

</body>

<script>
  Parse.initialize("p4tWFy9DoQKEKAxKNycBu3QH6htzRcZDzMw1ywFa", "kg3IFa5DBIGXraX5hegFsSM29giG1btPM3wUvxpN");
  var currentObj;
  //var currentTags;
  var currentIndexObj = 0;
  var currentIndexTag = 0;

  function onStart() {
    GetParse();
    showTag();

  }

  function GetParse() {
    var VALData = Parse.Object.extend("VALData");
    var query = new Parse.Query(VALData);
    query.limit(100);
    //query.skip(5);
    query.exists("tag");
    query.find({
      success: function(results) {
        //alert("Successfully retrieved " + results.length + " objects.");
        //alert(results[0].get("imageId"));
        currentObj = results.slice(0);
        // Do something with the returned Parse.Object values
        //arrayObjects = results.slice(0);
        //for (var i = 0; i < 5; i++) {
        //arrayObjects[i] = results[i];
        //alert(object.id + ' - ' + object.get('tag'));
        //document.getElementById("cap_20").innerHTML = object.get("tag");
        //}
      },
      error: function(error) {
        alert("Error: " + error.code + " " + error.message);
      }
    });
    //currentTags = currentObj[0].get("tag");
    //alert(currentTags[0]);
    //alert(currentTags[1]);
    //alert(currentTags.length);
    //document.getElementById("tagview").innerHTML = currentTags[0];
    if (currentObj[currentIndexObj].get("tag") == null)
    {
        displayQuestions();
    }
    else
    {
      showTag();
    }
    document.getElementById("image").src = "http://mscoco.org/images/" + currentObj[currentIndexObj].get("imageId");
    //alert("http://mscoco.org/images/" + currentObj[currentIndexObj].get("imageId"));
    document.getElementById("image").style.display = "block";
    //showTag();
  }

  function nextTagClick() {
    var currentArr;
    if (document.getElementById("yesTag").checked) {
      //alert("entered good");
      currentArr = currentObj[currentIndexObj].get("goodTag");
      currentArr[currentIndexTag]++;
      currentObj[currentIndexObj].set("goodTag", currentArr);
      currentObj[currentIndexObj].save();
      //alert("saved good");
    } else if (document.getElementById("noTag").checked) {
      //alert("entered bad");
      currentArr = currentObj[currentIndexObj].get("badTag");
      currentArr[currentIndexTag]++;
      currentObj[currentIndexObj].set("badTag", currentArr);
      currentObj[currentIndexObj].save();
      //alert("saved bad");
    }
    uncheck();
    if (currentIndexTag < (currentObj[currentIndexObj].get("tag").length - 1))
      currentIndexTag++;
    else {
      currentIndexTag = 0;
      displayQuestions();
    }
    showTag();
  }

  function displayQuestions() {
    document.getElementById("tagPara").style.display = "none";
    document.getElementById("questionsPara").style.display = "block";
  }

  function uncheck() {
    document.getElementById("yesTag").checked = false;
    document.getElementById("noTag").checked = false;
  }

  function showTag() {
    if (currentIndexTag < currentObj[currentIndexObj].get("tag").length) {
      document.getElementById("tagview").innerHTML = currentObj[currentIndexObj].get("tag")[currentIndexTag];
      //alert(currentTags[currentIndexTag]);
    } else {
      document.getElementById("tagview").innerHTML = "no more";
      currentIndexTag = 0;
      //next
    }
  }

  function addTag()
  {
    var currString = document.getElementById("answer").value;
    var currArr;
    var exists = true;
    if (currString.length > 2)
    {
      currArr = currentObj[currentIndexObj].get("tag");
      for (var i = 0; i < currArr.length; i++)
      {
        if (currArr[i] == currString)
        {
          exists = false;
        }
      }
      if (exists)
      {
        currentObj[currentIndexObj].add("tag", currString);
        currentObj[currentIndexObj].add("goodTag", 0);
        currentObj[currentIndexObj].add("badTag", 0);
        currentObj[currentIndexObj].save();
        document.getElementById("answer").value = "";
      }
      else
      {
        alert("This tag already exists");
      }
    }
    else
      alert("Invalid tag");
  }

  function saveParse()
  {
    alert("parse save enter");
    currentObj[currentIndexObj].add("numPeople", findNumPpl());
    currentObj[currentIndexObj].add("goodPic", findGoodPic());
    currentObj[currentIndexObj].save();
    alert("parse saved exit");
  }

  function nextPicClick()
  {
      if (fitsRequired())
      {
        saveParse();
      }
  }

  function fitsRequired()
  {
    if (findNumPpl() == "not checked")
    {
        alert('No number of people option checked');
        return false;
    }
    if (findGoodPic() == "not checked")
    {
        alert('No good image option checked');
        return false;
    }
    return true;
  }    

  function findNumPpl()
  {
    if (document.getElementById("people_zero").checked)
        return 0;
    else if(document.getElementById("people_one").checked)
        return 1;
    else if (document.getElementById("people_two").checked)
        return 2;
    else if (document.getElementById("people_three").checked)
        return 3;
    else if (document.getElementById("people_four").checked)
        return 4;
    return "not checked";
  }

  function findGoodPic()
  {
    if(document.getElementById("good_yes").checked)
        return "yes";
    else if (document.getElementById("good_no").checked)
        return "no";
    return "not checked";
  }
</script>
